<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/../../../../upload/2020/04/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/../../../../upload/2020/04/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/../../../../upload/2020/04/favicon-16x16.png">
  <link rel="mask-icon" href="/../../../../favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CPT+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/@fancyapps/fancybox/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css">
  <script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.ckx.ink","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.15.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="测试数据：https:&#x2F;&#x2F;github.com&#x2F;datacharmer&#x2F;test_db">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL调优">
<meta property="og:url" content="https://blog.ckx.ink/2021/11/16/202646.html">
<meta property="og:site_name" content="开心">
<meta property="og:description" content="测试数据：https:&#x2F;&#x2F;github.com&#x2F;datacharmer&#x2F;test_db">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-11-16T12:26:46.000Z">
<meta property="article:modified_time" content="2023-12-06T15:41:53.860Z">
<meta property="article:author" content="开心">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.ckx.ink/2021/11/16/202646.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.ckx.ink/2021/11/16/202646.html","path":"2021/11/16/202646.html","title":"MySQL调优"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MySQL调优 | 开心</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">开心</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">盛年不重来，一日难再晨。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-reader"><a href="https://reader.ckx.ink/" rel="section" target="_blank"><i class="fa fa-book fa-fw"></i>reader</a></li><li class="menu-item menu-item-openai"><a href="https://openai.ckx.ink/" rel="section" target="_blank"><i class="fa fa-robot fa-fw"></i>openai</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B0%83%E4%BC%98%E7%9A%84%E4%B8%83%E4%B8%AA%E7%BB%B4%E5%BA%A6"><span class="nav-number">1.</span> <span class="nav-text">数据库调优的七个维度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">2.</span> <span class="nav-text">慢查询日志</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text">使用方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E5%AD%98%E6%94%BE%E4%BD%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">日志存放位置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">2.3.</span> <span class="nav-text">分析慢查询日志</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Explain-%E4%BD%BF%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">Explain 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#select-type"><span class="nav-number">3.1.</span> <span class="nav-text">select_type</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#type"><span class="nav-number">3.2.</span> <span class="nav-text">type</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">SQL 性能分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OPTIMIZER-TRACE"><span class="nav-number">5.</span> <span class="nav-text">OPTIMIZER_TRACE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%8A%E6%96%AD%E5%91%BD%E4%BB%A4"><span class="nav-number">6.</span> <span class="nav-text">数据库诊断命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JOIN-%E4%BC%98%E5%8C%96"><span class="nav-number">7.</span> <span class="nav-text">JOIN 优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LIMIT-%E4%BC%98%E5%8C%96"><span class="nav-number">8.</span> <span class="nav-text">LIMIT 优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#COUNT-%E4%BC%98%E5%8C%96"><span class="nav-number">9.</span> <span class="nav-text">COUNT 优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E8%AE%BA"><span class="nav-number">9.1.</span> <span class="nav-text">实验结论</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96"><span class="nav-number">9.2.</span> <span class="nav-text">如何优化</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ORDER-BY-%E4%BC%98%E5%8C%96"><span class="nav-number">10.</span> <span class="nav-text">ORDER BY 优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#rowid-%E6%8E%92%E5%BA%8F%EF%BC%88%E5%B8%B8%E8%A7%84%E6%8E%92%E5%BA%8F%EF%BC%89"><span class="nav-number">10.1.</span> <span class="nav-text">rowid 排序（常规排序）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%A8%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F%EF%BC%88%E4%BC%98%E5%8C%96%E6%8E%92%E5%BA%8F%EF%BC%89"><span class="nav-number">10.2.</span> <span class="nav-text">全字段排序（优化排序）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%93%E5%8C%85%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F"><span class="nav-number">10.3.</span> <span class="nav-text">打包字段排序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-Order-By"><span class="nav-number">10.4.</span> <span class="nav-text">优化 Order By</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96-filesort"><span class="nav-number">10.5.</span> <span class="nav-text">如何优化 filesort</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GROUP-BY-%E4%BC%98%E5%8C%96"><span class="nav-number">11.</span> <span class="nav-text">GROUP BY 优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96"><span class="nav-number">12.</span> <span class="nav-text">表结构设计优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E8%B0%83%E4%BC%98"><span class="nav-number">13.</span> <span class="nav-text">索引调优</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E7%9A%84%E8%B0%83%E4%BC%98"><span class="nav-number">13.1.</span> <span class="nav-text">字段的调优</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E5%88%97%E7%B4%A2%E5%BC%95%E5%92%8C%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95"><span class="nav-number">13.2.</span> <span class="nav-text">单列索引和组合索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="nav-number">13.3.</span> <span class="nav-text">覆盖索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%87%8D%E5%A4%8D%E7%B4%A2%E5%BC%95"><span class="nav-number">13.4.</span> <span class="nav-text">重复索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%86%97%E4%BD%99%E7%B4%A2%E5%BC%95%EF%BC%88%E9%92%88%E5%AF%B9-B-Tree-%E5%92%8C-B-Tree%EF%BC%89"><span class="nav-number">13.5.</span> <span class="nav-text">冗余索引（针对 B-Tree 和 B+Tree）</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="开心"
      src="/../../../../upload/2020/04/android-chrome-512x512.png">
  <p class="site-author-name" itemprop="name">开心</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/chenkaixin12121" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chenkaixin12121" rel="noopener me" target="_blank">GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chenkaixin12121@163.com" title="E-Mail → mailto:chenkaixin12121@163.com" rel="noopener me" target="_blank">E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/lib/@creativecommons/vocabulary/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://blog.levnli.cn/" title="https:&#x2F;&#x2F;blog.levnli.cn" rel="noopener" target="_blank">木子李</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://huangdf.xyz/" title="https:&#x2F;&#x2F;huangdf.xyz&#x2F;" rel="noopener" target="_blank">柒月是ni的谎言</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="pjax">
        <div class="sidebar-inner sidebar-post-related">
          <div class="animated">
              <div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i>
    相关文章
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2021/11/08/205723.html" rel="bookmark">
        <time class="popular-posts-time">2021-11-08</time>
        <br>
      索引失效问题
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2020/05/09/221141.html" rel="bookmark">
        <time class="popular-posts-time">2020-05-09</time>
        <br>
      MySQL配置主从复制
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2021/08/25/195945.html" rel="bookmark">
        <time class="popular-posts-time">2021-08-25</time>
        <br>
      分布式事务解决方案-Seata
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2020/05/08/000809.html" rel="bookmark">
        <time class="popular-posts-time">2020-05-08</time>
        <br>
      Linux环境下安装MySQL
      </a>
    </li>
  </ul>

          </div>
        </div>
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.ckx.ink/2021/11/16/202646.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/../../../../upload/2020/04/android-chrome-512x512.png">
      <meta itemprop="name" content="开心">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开心">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="MySQL调优 | 开心">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL调优
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-16 20:26:46" itemprop="dateCreated datePublished" datetime="2021-11-16T20:26:46+08:00">2021-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>12 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p>测试数据：<a target="_blank" rel="noopener" href="https://github.com/datacharmer/test_db">https://github.com/datacharmer/test_db</a></p>
</blockquote>
<span id="more"></span>

<h4 id="数据库调优的七个维度"><a href="#数据库调优的七个维度" class="headerlink" title="数据库调优的七个维度"></a>数据库调优的七个维度</h4><p>从上到下，效果越来越差，成本越来越高</p>
<ul>
<li>业务需求<ul>
<li>勇敢的对不合理的需求说不</li>
<li>拨乱反正</li>
</ul>
</li>
<li>系统架构<ul>
<li>做架构设计的时候，应充分考虑业务的实际情况，考虑好数据库的各种选择</li>
</ul>
</li>
<li>SQL 及索引<ul>
<li>根据需求编写良好的 SQL，并去创建足够高效的索引</li>
</ul>
</li>
<li>表结构<ul>
<li>设置良好的结构</li>
</ul>
</li>
<li>数据库参数设置<ul>
<li>设置合理的数据库性能参数</li>
</ul>
</li>
<li>系统配置<ul>
<li>操作系统提供了各种资料使用策略，设置合理的配置，以便数据库充分利用资源</li>
</ul>
</li>
<li>硬件<ul>
<li>选择什么配置的机器</li>
</ul>
</li>
</ul>
<h4 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h4><table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">作用</th>
<th align="center">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">log_out_put</td>
<td align="center">日志输出到哪儿，默认 FILE，表示文件，设置成TABLE，则将日志记录到 mysql.slow_log 中，也可设置多种格式，比如 FILE, TABLE</td>
<td align="center">FILE</td>
</tr>
<tr>
<td align="center">long_query_time</td>
<td align="center">执行时间超过这么久才记录到慢查询日志，单位秒，可使用小数表示小于秒的时间</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">log_queries_not_using_indexes</td>
<td align="center">是否要将未使用索引的 SQL 记录到慢查询日志中，此配置会无视 long-query-time 的的配置，生产环境建议关闭，开发环境建议开启</td>
<td align="center">OFF</td>
</tr>
<tr>
<td align="center">log_throttle_queries_not_using_indexes</td>
<td align="center">和 log_queries_not_using_indexes 配合使用，如果 log_queries_not_using_indexes 打开，则该参数将限制每分钟写入的、未使用索引的 SQL 数量</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">min_examined_row_limit</td>
<td align="center">扫描行数至少达到这么多才记录到慢查询日志</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">log_slow_admin_statements</td>
<td align="center">是否要记录管理语句，默认关闭，管理语句包括 ALTER TABLE，ANALYZE TABLE，CHECK TABLE，CREATE INDEX，DROP INDEX，OPTIMIZE TABLE，and REPAIR TAB</td>
<td align="center">ОFF</td>
</tr>
<tr>
<td align="center">slow_query_log_file</td>
<td align="center">指定慢查询日志文件路径</td>
<td align="center">datadir 目录下</td>
</tr>
<tr>
<td align="center">log_slow_slave_statements</td>
<td align="center">该参数在从库上设置，决定是否记录在复制过程中超过 long_query_time 的 SQL，如果 binlog 格式是 row，则该参数无效</td>
<td align="center">OFF</td>
</tr>
<tr>
<td align="center">log_slow_extra</td>
<td align="center">当 log_output&#x3D;FILE 时，是否要记录额外信息（MySQL 8.0.14 开始提供），对 log_output&#x3D;TABLE 的结果无影响</td>
<td align="center">OFF</td>
</tr>
</tbody></table>
<h5 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h5><ul>
<li>永久修改，修改配置文件 my.cnf，在 [mysqld] 下添加参数，重启 MySQL</li>
<li>临时修改，例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_output <span class="operator">=</span> <span class="string">&#x27;FILE,TABLE&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> long_query_time <span class="operator">=</span> <span class="number">0.001</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_queries_not_using_indexes <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：设置 long_query_time 需要断开连接才能生效</p>
</blockquote>
<h5 id="日志存放位置"><a href="#日志存放位置" class="headerlink" title="日志存放位置"></a>日志存放位置</h5><ul>
<li>表：select * from mysql.slow_log;</li>
<li>文件：show variables like ‘%slow_query_log_file%’;</li>
</ul>
<h5 id="分析慢查询日志"><a href="#分析慢查询日志" class="headerlink" title="分析慢查询日志"></a>分析慢查询日志</h5><ul>
<li>mysqldumpslow：mysqldumpslow -s t -t 10 -a DESKTOP-63C43K6-slow.log</li>
<li>pt-query-digest</li>
</ul>
<h4 id="Explain-使用"><a href="#Explain-使用" class="headerlink" title="Explain 使用"></a>Explain 使用</h4><table>
<thead>
<tr>
<th align="center">Column</th>
<th align="center">JSON Name</th>
<th align="center">Meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="center">id</td>
<td align="center">select_id</td>
<td align="center">该语句的唯一标识</td>
</tr>
<tr>
<td align="center">select_type</td>
<td align="center">None</td>
<td align="center">查询类型</td>
</tr>
<tr>
<td align="center">table</td>
<td align="center">table_name</td>
<td align="center">这行数据对应的表名</td>
</tr>
<tr>
<td align="center">partitions</td>
<td align="center">partitions</td>
<td align="center">匹配的分区</td>
</tr>
<tr>
<td align="center">type</td>
<td align="center">access_type</td>
<td align="center">连接类型</td>
</tr>
<tr>
<td align="center">possible_keys</td>
<td align="center">possible_keys</td>
<td align="center">可能使用的索引</td>
</tr>
<tr>
<td align="center">key</td>
<td align="center">key</td>
<td align="center">实际使用的索引</td>
</tr>
<tr>
<td align="center">key_len</td>
<td align="center">key_length</td>
<td align="center">索引的长度</td>
</tr>
<tr>
<td align="center">ref</td>
<td align="center">ref</td>
<td align="center">索引的哪一列被引用了</td>
</tr>
<tr>
<td align="center">rows</td>
<td align="center">rows</td>
<td align="center">估计要扫描的行</td>
</tr>
<tr>
<td align="center">filtered</td>
<td align="center">filtered</td>
<td align="center">符合查询条件的数据百分比</td>
</tr>
<tr>
<td align="center">Extra</td>
<td align="center">None</td>
<td align="center">附加信息</td>
</tr>
</tbody></table>
<h5 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h5><table>
<thead>
<tr>
<th align="center">select_type Value</th>
<th align="center">JSON Name</th>
<th align="center">Meaning</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SIMPLE</td>
<td align="center">None</td>
<td align="center">简单查询（未使用 UNION 或子查询）</td>
</tr>
<tr>
<td align="center">PRIMARY</td>
<td align="center">None</td>
<td align="center">嵌套查询时最外层的查询</td>
</tr>
<tr>
<td align="center">UNION</td>
<td align="center">None</td>
<td align="center">UNION 中的第二个或后面的 SELECT 语句</td>
</tr>
<tr>
<td align="center">DEPENDENT UNION</td>
<td align="center">dependent (true)</td>
<td align="center">UNION 中的第二个或后面的 SELECT 语句，取决于外部查询</td>
</tr>
<tr>
<td align="center">UNION RESULT</td>
<td align="center">union_result</td>
<td align="center">UNION 的结果</td>
</tr>
<tr>
<td align="center">SUBQUERY</td>
<td align="center">None</td>
<td align="center">子查询中的第一个 SELECT</td>
</tr>
<tr>
<td align="center">DEPENDENT SUBQUERY</td>
<td align="center">dependent (true)</td>
<td align="center">子查询中的第一个 SELECT，取决于外部查询</td>
</tr>
<tr>
<td align="center">DERIVED</td>
<td align="center">None</td>
<td align="center">用来表示包含在 FROM 子句的子查询中的 SELECT，MySQL 会递归执行并将结果放到一个临时表中，MySQL 内部将其称为是 Derived table（派生表），因为该临时表是从子查询派生出来的</td>
</tr>
<tr>
<td align="center">DEPENDENT DERIVED</td>
<td align="center">dependent (true)</td>
<td align="center">依赖于另一个表的派生表</td>
</tr>
<tr>
<td align="center">MATERIALIZED</td>
<td align="center">materialized_from_subquery</td>
<td align="center">物化子查询</td>
</tr>
<tr>
<td align="center">UNCACHEABLE SUBQUERY</td>
<td align="center">cacheable (false)</td>
<td align="center">子查询，结果无法缓存，必须针对外部查询的每一行重新评估</td>
</tr>
<tr>
<td align="center">UNCACHEABLE UNION</td>
<td align="center">cacheable (false)</td>
<td align="center">UNION 属于UNCACHEABLE SUBQUERY 的第二个或后面的查询</td>
</tr>
</tbody></table>
<h5 id="type"><a href="#type" class="headerlink" title="type"></a>type</h5><p>扫描方式由快到慢</p>
<ul>
<li>sytem：该表只有一行（等于系统表），system 是 const 类型的特殊</li>
<li>const：命中主键和唯一索引，最多返回一条数据，const 查询非常快，因为它只读取一次</li>
<li>eq_ref：当使用了索引的全部组成部分，并且索引是主键或唯一索引才会使用该类型</li>
<li>ref：当满足索引的最左前缀规则，或者命中普通索引时才会发生</li>
<li>fulltext：全文索引</li>
<li>ref_or_null：该类型类似于 ref，但是 MySQL 会额外搜索哪些行包含 NULL，这种类型常见于解析子查询</li>
<li>index_merge：此类型使用了索引合并优化，表示一个查询里面用到了多个索引</li>
<li>unique_subquery：该类型和 eq_ref 类似，但是使用了 IN 查询，且子查询是主键或者唯一索引</li>
<li>index_subquery：和 unique_subquery 类似，只是子查询使用的是非唯一索引</li>
<li>range：只检索给定范围的行</li>
<li>index：与 ALL 的区别是 index 类型只遍历索引树</li>
<li>ALL：遍历全表以找到匹配的行</li>
</ul>
<h4 id="SQL-性能分析"><a href="#SQL-性能分析" class="headerlink" title="SQL 性能分析"></a>SQL 性能分析</h4><ul>
<li>information_schema</li>
</ul>
<p>从 MySQL8.0 开始，这个表已经开始被废弃</p>
<ul>
<li>performance_schema</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查看是否开启性能监控</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.setup_actors;</span><br><span class="line"># 开启相关监控项</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_instruments <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%statement/%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_instruments <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%stage/%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_consumers <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%events_statements_%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_consumers <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%events_stages_%&#x27;</span>;</span><br><span class="line"># 要执行的 <span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> salaries;</span><br><span class="line"># 获取语句的 EVENT_ID</span><br><span class="line"><span class="keyword">SELECT</span> EVENT_ID, <span class="keyword">TRUNCATE</span> ( TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000000</span>, <span class="number">6</span> ) <span class="keyword">AS</span> Duration, SQL_TEXT <span class="keyword">FROM</span> PERFORMANCE_SCHEMA.events_statements_history_long <span class="keyword">WHERE</span> SQL_TEXT <span class="keyword">LIKE</span> <span class="string">&#x27;%salaries%&#x27;</span></span><br><span class="line"># 性能分析</span><br><span class="line"><span class="keyword">SELECT</span> event_name <span class="keyword">AS</span> Stage, <span class="keyword">TRUNCATE</span> ( TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000000</span>, <span class="number">6</span> ) <span class="keyword">AS</span> Duration <span class="keyword">FROM</span> PERFORMANCE_SCHEMA.events_stages_history_long <span class="keyword">WHERE</span> NESTING_EVENT_ID <span class="operator">=</span> <span class="number">268</span></span><br></pre></td></tr></table></figure>

<h4 id="OPTIMIZER-TRACE"><a href="#OPTIMIZER-TRACE" class="headerlink" title="OPTIMIZER_TRACE"></a>OPTIMIZER_TRACE</h4><h4 id="数据库诊断命令"><a href="#数据库诊断命令" class="headerlink" title="数据库诊断命令"></a>数据库诊断命令</h4><ul>
<li>SHOW PROCESSLIST：查看当前正在运行的进程</li>
<li>SHOW STATUS：查看服务器相关信息</li>
<li>SHOW VARIABLES：查看 MySQL 的变量</li>
<li>SHOW TABLE STATUS：查看表以及视图的状态</li>
<li>SHOW INDEX：查看索引相关信息</li>
<li>SHOW ENGINE：展示有关存储引擎的相关信息</li>
<li>SHOW MASTER STATUS：展示有并 master binlog 文件的相关信息</li>
<li>SHOW SLAVE STATUS：展示 slave 线程的相关信息</li>
<li>SHOW PROCEDURE：查看存储过程</li>
<li>SHOW FUNCTION STATUS：查看函数</li>
<li>SHOW TRIGGERS：查看触发器的基本信息</li>
<li>SHOW WARNINGS：显示最后一个执行的语句所产生的错误、警告和通知</li>
<li>SHOW ERRORS：显示最后一个执行语句所产生的错误</li>
<li>SHOW BINARY LOGS：获取 binlog 文件列表</li>
<li>SHOW BINLOG EVENTS：只查看第一个 binlog 文件的内容</li>
<li>SHOW RELAYLOG EVENTS：查看 relaylog 文件内容</li>
</ul>
<h4 id="JOIN-优化"><a href="#JOIN-优化" class="headerlink" title="JOIN 优化"></a>JOIN 优化</h4><p>外层循环的表是驱动表，内层循环的表是被驱动表</p>
<ul>
<li>小表驱动大表</li>
<li>如果有 where 条件，应当要能够使用索引，并尽可能地减少外尝循环的数据量</li>
<li>join 的字段尽量创建索引</li>
<li>尽量减少扫描的行数</li>
<li>参数 join 的表不要太多</li>
<li>如果被驱动的表的 join 字段用不了索引，且内存较为充足，可以考虑把 join_buffer 设置得大一些</li>
</ul>
<h4 id="LIMIT-优化"><a href="#LIMIT-优化" class="headerlink" title="LIMIT 优化"></a>LIMIT 优化</h4><ul>
<li>覆盖索引 + join</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees e <span class="keyword">inner</span> <span class="keyword">join</span> (<span class="keyword">select</span> emp_no <span class="keyword">from</span> employees limit <span class="number">300000</span>, <span class="number">10</span>) t <span class="keyword">on</span> e.emp_no <span class="operator">=</span> t.emp_no;</span><br></pre></td></tr></table></figure>

<ul>
<li>覆盖索引 + 子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">where</span> emp_no <span class="operator">&gt;=</span> (<span class="keyword">select</span> emp_no <span class="keyword">from</span> employees limit <span class="number">300000</span>, <span class="number">1</span>) limit <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>范围查询 + limit 语句</li>
</ul>
<p>前提：拿到上一页的主键最大值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">where</span> emp_no <span class="operator">&gt;=</span> <span class="number">100100</span> limit <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果可以获取起始主键值和结束主键值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">where</span> emp_no <span class="keyword">between</span> <span class="number">100110</span> <span class="keyword">and</span> <span class="number">100120</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>禁止传入过大的页码</li>
</ul>
<p>因为页面有筛选条件存在，所以我们可以限制只能查询前几千条数据，已经足够了</p>
<h4 id="COUNT-优化"><a href="#COUNT-优化" class="headerlink" title="COUNT 优化"></a>COUNT 优化</h4><h5 id="实验结论"><a href="#实验结论" class="headerlink" title="实验结论"></a>实验结论</h5><ul>
<li>count(*) 和 count(1) 一样</li>
<li>count(*) 会选择最小的非主键索引，如果不存在任何非主键索引，则会使用主键</li>
<li>count(*) 不会排除掉该字段值为 null 的行，count(字段) 会排除</li>
<li>对于不带查询条件的 count(*) 语句，MyISAM 和 InnoDB（MySQL &gt;&#x3D; 8.0.13），都做了优化</li>
<li>如果没有特殊需求，尽量使用 count(*)</li>
</ul>
<h5 id="如何优化"><a href="#如何优化" class="headerlink" title="如何优化"></a>如何优化</h5><ul>
<li>创建一个更小的非主键索引</li>
<li>把数据库引擎换成 MyISAM，一般不使用</li>
<li>汇总表</li>
<li>缓存结果</li>
<li>sql_calc_found_rows</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sql_calc_found_rows <span class="operator">*</span> <span class="keyword">from</span> salaries;</span><br><span class="line"><span class="keyword">select</span> found_rows() <span class="keyword">as</span> salary_count;</span><br></pre></td></tr></table></figure>

<ul>
<li>information_schema</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> TABLE_ROWS <span class="keyword">from</span> information_schema.TABLES <span class="keyword">where</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;employees&#x27;</span> <span class="keyword">and</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;salaries&#x27;</span></span><br></pre></td></tr></table></figure>

<p>好处：不操作 salaries 表，无论它有多少数据，都可以迅速地返回结果<br>缺点：返回的不是准确值，只是估算值</p>
<ul>
<li>show table status，同上</li>
<li>explain，同上</li>
</ul>
<h4 id="ORDER-BY-优化"><a href="#ORDER-BY-优化" class="headerlink" title="ORDER BY 优化"></a>ORDER BY 优化</h4><h5 id="rowid-排序（常规排序）"><a href="#rowid-排序（常规排序）" class="headerlink" title="rowid 排序（常规排序）"></a>rowid 排序（常规排序）</h5><ol>
<li>从表中获取满足 WHERE 条件的记录</li>
<li>对于每条记录，将记录的主键及排序键（id，order_column）取出放入 sort buffer（由 sort_buffer_size 控制） </li>
<li>如果 sort_buffer 能存放所有满足条件的（id，order_column），则进行排序，否则 sort_buffer 满后，排序（快速排序算法<br>）并写到临时文件</li>
<li>若排序中产生了临时文件，需要利用归并排序算法，从而保证有序</li>
<li>循环执行上述过程，直到所有满足条件的记录全部参与排序</li>
<li>扫描排好序的（id，order_column）对，并利用 id 去取 SELECT 需要返回的其他字段</li>
<li>返回结果集</li>
</ol>
<p>特点：</p>
<ul>
<li>看 sort_buffer 是否能存放结果集里面的所有（id，order_column），如果不满足，就会产生临时文件</li>
<li>一次排序需要两次 IO<ul>
<li>第 2 步：把（id，order_column）扔到 sort_buffer</li>
<li>第 6 步：通过 id 去获取需要返回的其他字段，由于返回结果是按照 order_column 排序的，所以 id 是乱序的，会存在随机 IO 的问题，MySQL 内部针对这种情况做了个优化，在用 id 取数据之前排序并放到一个缓存里面，这个缓存大小由 read_rnd_buffer_size 控制，接着再去取记录，从而把随机 IO 转换成顺序 IO</li>
</ul>
</li>
</ul>
<h5 id="全字段排序（优化排序）"><a href="#全字段排序（优化排序）" class="headerlink" title="全字段排序（优化排序）"></a>全字段排序（优化排序）</h5><ul>
<li>直接取出SQL中需要的所有字段，放到 sort_buffer </li>
<li>由于 sort_buffer 已经包含了查询需要的所有字段，因此在 sort_buffer 中排序完成后可直接返回</li>
</ul>
<p>好处：性能的提升，无需两次 IO<br>缺点：一行数据占用的空间一般比 rowid 排序多，如果 sort_buffer 比较小，容易导致临时文件<br>如果选择：使用 max_length_for_sort_data，当 ORDER BY SQL 中出现字段总长度小于该值，使用全字段排序，否则使用 rowid 排序</p>
<h5 id="打包字段排序"><a href="#打包字段排序" class="headerlink" title="打包字段排序"></a>打包字段排序</h5><ul>
<li>MySQL 5.7 引入</li>
<li>全字段模式的优化，工作原理一样，但是将字段紧密地排列在一起而不是使用固定长度空间<blockquote>
<p>VARCHAR(255) “yes”：不打包 255字节，打包 2+3字节</p>
</blockquote>
</li>
</ul>
<h5 id="优化-Order-By"><a href="#优化-Order-By" class="headerlink" title="优化 Order By"></a>优化 Order By</h5><ul>
<li>利用索引，防止 filesort 的发生</li>
<li>如果发生了 filesort，并且没办法避免，想办法优化 filesort</li>
</ul>
<h5 id="如何优化-filesort"><a href="#如何优化-filesort" class="headerlink" title="如何优化 filesort"></a>如何优化 filesort</h5><ul>
<li>调大 sort_buffer_size，减少&#x2F;避免临时文件、归并操作<ul>
<li>optimizer trace 中 num_initial_chunks_spilled_to_disk 的值</li>
<li>sort_merge_passes 变量的值</li>
</ul>
</li>
<li>调大 read_rnd_buffer_size，让一次顺序 IO 返回的结果更多</li>
<li>设置合理的 max_length_for_sort_data 的值<ul>
<li>一般不建议随意调整</li>
</ul>
</li>
<li>调小 max_sort_length（排序时最多取多少字节）</li>
</ul>
<h4 id="GROUP-BY-优化"><a href="#GROUP-BY-优化" class="headerlink" title="GROUP BY 优化"></a>GROUP BY 优化</h4><p>性能依次递减</p>
<ul>
<li>松散索引扫描（Loose Index Scan）</li>
<li>紧凑索引扫描（Tight Index Scan）</li>
<li>临时表（Temporary table）</li>
</ul>
<h4 id="表结构设计优化"><a href="#表结构设计优化" class="headerlink" title="表结构设计优化"></a>表结构设计优化</h4><ul>
<li>字段少而精，建议 20 个以内<ul>
<li>把常用的字段放到一起</li>
<li>把不常用的字段独立出去</li>
<li>大字段（TEXT&#x2F;BLOB&#x2F;CLOB 等等）独立出去</li>
</ul>
</li>
<li>尽量用小型字段<ul>
<li>用数字替代字符串</li>
</ul>
</li>
<li>避免使用允许为 NULL 的字段<ul>
<li>允许为 NULL 字段很难查询优化</li>
<li>允许为 NULL 字段的索引需要额外空间</li>
</ul>
</li>
<li>合理平衡范式和冗余</li>
<li>如果数据量非常大，考虑分库分表</li>
</ul>
<h4 id="索引调优"><a href="#索引调优" class="headerlink" title="索引调优"></a>索引调优</h4><h5 id="字段的调优"><a href="#字段的调优" class="headerlink" title="字段的调优"></a>字段的调优</h5><p>新增一个字段，使用函数计算 hash 值（CRC32 或者 FNV64），存储起来，并将该字段添加索引，查询时使用 first_name_hash &#x3D; CRC32(‘chenkaixin12121’) 查询即可</p>
<p>缺点：like 无法使用该方式进行优化<br>解决方案：添加前缀索引</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">索引选择性 = 不重复的索引值/数据表的总记录数</span><br><span class="line"></span><br><span class="line"># 完整列的选择性</span><br><span class="line">select count(distinct first_name)/count(*) from employees;</span><br><span class="line"># 计算前缀索引的长度</span><br><span class="line">select count(distinct left(first_name, 8))/count(*) from employees;</span><br><span class="line"># 添加索引</span><br><span class="line">alter table employees add key (first_name(8))</span><br><span class="line"></span><br><span class="line">注意：无法做 order by, group by；无法使用覆盖索引</span><br></pre></td></tr></table></figure>

<h5 id="单列索引和组合索引"><a href="#单列索引和组合索引" class="headerlink" title="单列索引和组合索引"></a>单列索引和组合索引</h5><ul>
<li>SQL 存在多个条件，多个单列索引，会使用索引合并</li>
<li>如果出现索引合并，往往说明索引不够合理</li>
<li>如果 SQL 暂时没有性能问题，暂时可以不管</li>
<li>组合索引要注意索引列顺序</li>
</ul>
<h5 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h5><p>对应索引 X，SELECT 的字段只需从索引就能获得，而无需到表数据里获取，这样的索引就叫覆盖索引</p>
<ul>
<li>覆盖索引能提交SQL的性能</li>
<li>SELECT 尽量只返回想要的字段（使用覆盖索引，减少网络传输的开销）</li>
</ul>
<h5 id="重复索引"><a href="#重复索引" class="headerlink" title="重复索引"></a>重复索引</h5><p>索引是有开销的，增删改的时候，索引的维护开销，索引越多，开销越大，条件允许的情况下，尽量少创建索引</p>
<p>explain select * from salaries where from_date &#x3D; ‘1986-06-26’ order by  emp_no;<br>索引 index(from_date): type&#x3D;ref extra&#x3D;null，使用了索引<br>索引 index(from_date) 某种意义上来说就相当于 index(from_date, emp_no)</p>
<p>修改索引 index(from_date,to_date) 再次执行<br>explain select * from salaries where from_date &#x3D; ‘1986-06-26’ order by  emp_no;<br>索引 index(from_date,to_date): type&#x3D;ref extra&#x3D;Using filesort 说明 order by 子句无法使用索引<br>索引 index(from_date, to_date) 某种意义上来说就相当于index(from_date, to_date, emp_no)，不符合最左前缀原则，所以 order by 子句无法使用索引</p>
<h5 id="冗余索引（针对-B-Tree-和-B-Tree）"><a href="#冗余索引（针对-B-Tree-和-B-Tree）" class="headerlink" title="冗余索引（针对 B-Tree 和 B+Tree）"></a>冗余索引（针对 B-Tree 和 B+Tree）</h5><p>如果已经存在索引 index(A,B)，又创建了 index(A)，那么 index(A) 就是 index(A,B) 的冗余索引</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>开心
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://blog.ckx.ink/2021/11/16/202646.html" title="MySQL调优">https://blog.ckx.ink/2021/11/16/202646.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/11/09/222019.html" rel="prev" title="LVS+Nginx+Keepalived高可用集群">
                  <i class="fa fa-chevron-left"></i> LVS+Nginx+Keepalived高可用集群
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/11/20/161804.html" rel="next" title="分库分表-ShardingJDBC">
                  分库分表-ShardingJDBC <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC81ODIwNS8zNDY2OA=="></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">豫ICP备20013274号-1 </a>
  </div>

<div class="copyright">
  &copy; 2020 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开心</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">101k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">6:07</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/chenkaixin12121" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="/lib/jquery/dist/jquery.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
  <script src="/lib/@fancyapps/fancybox/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="/lib/pangu/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="/lib/hexo-generator-searchdb/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script src="/lib/quicklink/dist/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://blog.ckx.ink/2021/11/16/202646.html"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<script src="/js/third-party/comments/livere.js"></script>

</body>
</html>
